<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>runtrades | Dashboard</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- Top Bar -->
  <header class="topbar">
    <div class="brand">
      <img src="images/logo.jpg" alt="runtrades logo" class="brand-logo">

      <div>
        <div class="brand-title">runtrades</div>
        <div class="brand-sub">Trading Journal</div>
      </div>
    </div>

    <nav class="topnav">
      <a class="navlink" href="#">Journal</a>
      <a class="navlink" href="#">History</a>
      <a class="navlink active" href="#">Dashboard</a>
    </nav>

    <div class="topbar-right">
      <div class="user">Ntarindwa</div>
      <button class="btn danger">Logout</button>
    </div>
  </header>

  <!-- Page -->
  <main class="page">
    <section class="hero">
      <h1>Trading Dashboard</h1>
      <p>Your trading performance at a glance</p>
      
      <div class="hero-actions">
  <button class="btn primary" id=openTrade>+ New Trade</button>
</div>
    </section>

    <!-- Stats Grid -->
    <section class="grid">
      <div class="card card-wide">
        <div class="card-head">
          <div>
            <div class="label">Net Profit &amp; Loss</div>
            <div class="big">$554.71</div>
            <div class="muted">+ 6 trades completed</div>
          </div>
          <div class="icon-pill">$</div>
        </div>

        <div class="mini-grid">
          <div class="mini">
            <div class="mini-label">Win Rate</div>
            <div class="mini-val">17%</div>
          </div>
          <div class="mini">
            <div class="mini-label">Profit Factor</div>
            <div class="mini-val">1.36</div>
          </div>
          <div class="mini">
            <div class="mini-label">Avg Confluence</div>
            <div class="mini-val">95%</div>
          </div>
        </div>
      </div>

      <div class="card card-green">
        <div class="label">Total Profit</div>
        <div class="mid">$2.1K</div>
        <div class="muted">1 winning trades</div>
      </div>

      <div class="card card-red">
        <div class="label">Total Loss</div>
        <div class="mid">$1.5K</div>
        <div class="muted">2 losing trades</div>
      </div>

      <div class="card">
        <div class="row">
          <div class="badge">üèÖ</div>
          <div>
            <div class="label">Largest Win</div>
            <div class="mid">$2,091.61</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="row">
          <div class="badge">üéØ</div>
          <div>
            <div class="label">Largest Loss</div>
            <div class="mid">$941.00</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="row">
          <div class="badge">üî•</div>
          <div>
            <div class="label">Best Streak</div>
            <div class="mid">1</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="row">
          <div class="badge">üìà</div>
          <div>
            <div class="label">Total Trades</div>
            <div class="mid">9</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Calendar -->
    <section class="calendar-wrap">
      <div class="calendar-head">
        <div class="calendar-title">Trading Calendar</div>
        <div class="calendar-actions">
  <button class="btn ghost" id="calToday">Today</button>
  <div class="month" id="calMonthLabel">January 2026</div>
  <button class="btn ghost" id="calPrev">‚óÄ</button>
  <button class="btn ghost" id="calNext">‚ñ∂</button>
</div>


      <div class="calendar-grid" id="calGrid">
  <!-- Days generated by JavaScript -->
</div>

    </section>

  </main>
<!-- New Trade Modal -->
<div class="modal" id="tradeModal" aria-hidden="true">
  <div class="modal-backdrop" id="closeBackdrop"></div>

  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-head">
      <h2 id="modalTitle">New Trade</h2>
      <button class="btn ghost" id="closeTrade">‚úï</button>
    </div>

    <form class="form" id="tradeForm">
      <div class="form-grid">
        <label>
          <span>Pair</span>
          <input id="pair" type="text" placeholder="EURUSD" required>
        </label>

        <label>
          <span>Direction</span>
          <select id="direction" required>
            <option value="">Select</option>
            <option value="Buy">Buy</option>
            <option value="Sell">Sell</option>
          </select>
        </label>

        <label>
          <span>Date</span>
          <input id="date" type="date" required>
        </label>

        <label>
          <span>P&amp;L ($)</span>
          <input id="pnl" type="number" step="0.01" placeholder="e.g. 45.50" required>
        </label>

        <label class="full">
          <span>Notes</span>
          <textarea id="notes" rows="4" placeholder="Why did you take this trade? What was your plan?"></textarea>
        </label>
      </div>

      <div class="form-actions">
        <button type="button" class="btn ghost" id="cancelTrade">Cancel</button>
        <button type="submit" class="btn primary">Save Trade</button>
      </div>
    </form>
  </div>
</div>
<!-- Trade History -->
<section class="panel" id="history">
  <div class="panel-head">
    <h2>Trade History</h2>
    <div class="panel-actions">
      <button class="btn ghost" id="clearTradesBtn" type="button">Clear all</button>
    </div>
  </div>

  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Pair</th>
          <th>Direction</th>
          <th>P&amp;L</th>
          <th>Notes</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="historyBody"></tbody>
    </table>

    <p class="empty" id="historyEmpty" style="display:none;">
      No trades yet. Add your first trade.
    </p>
  </div>
</section>

<script>

  const openBtn = document.getElementById('openTrade');
  const modal = document.getElementById('tradeModal');
  const closeBtn = document.getElementById('closeTrade');
  const cancelBtn = document.getElementById('cancelTrade');
  const backdrop = document.getElementById('closeBackdrop');
  const form = document.getElementById('tradeForm');


  const STORAGE_KEY = 'runtrades_trades';
const historyBody = document.getElementById('historyBody');
const historyEmpty = document.getElementById('historyEmpty');
const clearTradesBtn = document.getElementById('clearTradesBtn');

function formatMoney(n){
  const num = Number(n) || 0;
  const sign = num >= 0 ? '+' : '';
  return `${sign}${num.toFixed(2)}`;
}

function renderHistory(){
  const trades = loadTrades();

  if (!trades.length){
    historyBody.innerHTML = '';
    historyEmpty.style.display = 'block';
    return;
  }

  historyEmpty.style.display = 'none';

  const sorted = [...trades].sort((a,b) => (b.id || 0) - (a.id || 0));

  historyBody.innerHTML = sorted.map(t => {
    const dir = (t.direction || '').toLowerCase();
    const dirClass = dir === 'sell' ? 'sell' : 'buy';
    const pnl = Number(t.pnl || 0);
    const pnlClass = pnl >= 0 ? 'pnl-pos' : 'pnl-neg';
    const safeNotes = (t.notes || '').replaceAll('<','&lt;').replaceAll('>','&gt;');

    return `
      <tr>
        <td>${t.date || ''}</td>
        <td>${(t.pair || '').toUpperCase()}</td>
        <td><span class="badge ${dirClass}">${t.direction || ''}</span></td>
        <td class="${pnlClass}">${formatMoney(pnl)}</td>
        <td style="max-width:360px; white-space:pre-wrap;">${safeNotes}</td>
        <td>
          <div class="row-actions">
            <button class="icon-btn" data-delete="${t.id}" type="button">Delete</button>
          </div>
        </td>
      </tr>
    `;
  }).join('');
}

function deleteTrade(id){
  const trades = loadTrades().filter(t => String(t.id) !== String(id));
  saveTrades(trades);
  renderHistory();
}

  function openModal() {
    modal.classList.add('show');
    modal.setAttribute('aria-hidden', 'false');
  }

  function closeModal() {
    modal.classList.remove('show');
    modal.setAttribute('aria-hidden', 'true');
  }

  function loadTrades() {
    return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
  }

  function saveTrades(trades) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(trades));
  }
// ===== Calendar (OUTSIDE submit) =====
const calGrid = document.getElementById("calGrid");
const calMonthLabel = document.getElementById("calMonthLabel");
const calPrev = document.getElementById("calPrev");
const calNext = document.getElementById("calNext");
const calToday = document.getElementById("calToday");

let calCursor = new Date(2026, 0, 1); // Jan 2026

function monthName(m){
  return ["January","February","March","April","May","June","July","August","September","October","November","December"][m];
}

function ymd(date){
  const y = date.getFullYear();
  const m = String(date.getMonth() + 1).padStart(2, "0");
  const d = String(date.getDate()).padStart(2, "0");
  return `${y}-${m}-${d}`;
}

function sumPnlForDate(trades, dateStr){
  let total = 0, count = 0;
  for (const t of trades){
    if (t.date === dateStr){
      total += Number(t.pnl) || 0;
      count++;
    }
  }
  return { total, count };
}
function showDayDetails(dateStr) {
    const trades = loadTrades().filter(t => t.date === dateStr);

    if (calDayTitle) calDayTitle.textContent = `Trades ‚Äî ${dateStr}`;

    if (!trades.length) {
      calDayList.innerHTML = `<div class="cal-empty">No trades on this day.</div>`;
    } else {
      calDayList.innerHTML = trades.map(t => `
        <div class="cal-trade">
          <strong>${t.pair}</strong>
          <span>${t.direction}</span>
          <span>${Number(t.pnl) >= 0 ? '+' : ''}${Number(t.pnl).toFixed(2)}</span>
        </div>
      `).join('');
    }

    calDayDetails.style.display = 'block';
  }
function renderCalendar(){
  if(!calGrid) return;

  const year = calCursor.getFullYear();
  const month = calCursor.getMonth();
  calMonthLabel.textContent = `${monthName(month)} ${year}`;

  calGrid.innerHTML = "";

  // headers
  ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(d => {
    const el = document.createElement("div");
    el.className = "dow";
    el.textContent = d;
    calGrid.appendChild(el);
  });

  const first = new Date(year, month, 1);
  const last = new Date(year, month + 1, 0);
  const startPad = first.getDay();
  const totalDays = last.getDate();

  const trades = loadTrades();

  for(let i=0; i<startPad; i++){
    const empty = document.createElement("div");
    empty.className = "day empty";
    calGrid.appendChild(empty);
  }

  for(let day=1; day<=totalDays; day++){
    const dateObj = new Date(year, month, day);
    const dateStr = ymd(dateObj);
    const { total, count } = sumPnlForDate(trades, dateStr);

    const cell = document.createElement("div");
    cell.className = "day";
    cell.dataset.date = dateStr;

    const num = document.createElement("span");
    num.className = "num";
    num.textContent = day;
    cell.appendChild(num);

    if(count > 0){
      const pnl = document.createElement("div");
      pnl.style.marginTop = "8px";
      pnl.style.fontWeight = "700";
      pnl.style.fontSize = "0.9rem";
      pnl.textContent = `${total >= 0 ? "+" : ""}${total.toFixed(2)}`;
      cell.appendChild(pnl);
    }
    // ‚úÖ CLICK DAY -> show details
    cell.addEventListener("click", () => {
      showDayDetails(dateStr);
    });

    calGrid.appendChild(cell);
  }
}

if (calPrev) calPrev.addEventListener("click", () => {
  calCursor = new Date(calCursor.getFullYear(), calCursor.getMonth() - 1, 1);
  renderCalendar();
});
if (calNext) calNext.addEventListener("click", () => {
  calCursor = new Date(calCursor.getFullYear(), calCursor.getMonth() + 1, 1);
  renderCalendar();
});
if (calToday) calToday.addEventListener("click", () => {
  const now = new Date();
  calCursor = new Date(now.getFullYear(), now.getMonth(), 1);
  renderCalendar();
});

// first render
renderCalendar();

  openBtn.addEventListener('click', openModal);
  closeBtn.addEventListener('click', closeModal);
  cancelBtn.addEventListener('click', closeModal);
  backdrop.addEventListener('click', closeModal);

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeModal();
  });

  form.addEventListener('submit', (e) => {
    e.preventDefault();
const pairEl = document.getElementById('pair');
const directionEl = document.getElementById('direction');
const dateEl = document.getElementById('date');
const pnlEl = document.getElementById('pnl');
const notesEl = document.getElementById('notes');

if (!pairEl || !directionEl || !dateEl || !pnlEl || !notesEl) {
  alert('Form fields are missing IDs. Please refresh and try again.');
  return;
}


    const trade = {
      id: Date.now(),
      pair: pairEl.value.toUpperCase(),
      direction: directionEl.value,
      date: dateEl.value,
      pnl: Number(pnlEl.value),
      notes: notesEl.value.trim()
    };

    if (!trade.pair || !trade.direction || !trade.date || isNaN(trade.pnl)) {
      alert('Please fill all required fields correctly.');
      return;
    }

    const trades = loadTrades();
    trades.push(trade);
    saveTrades(trades);
    renderHistory();
    renderCalendar();
    
  // ===== Step 3.1: Click a calendar day -> show trades list =====
  const calDayDetails = document.getElementById("calDayDetails");
  const calDayTitle = document.getElementById("calDayTitle");
  const calDayList = document.getElementById("calDayList");
  const calCloseDetails = document.getElementById("calCloseDetails");

  function showDayDetails(dateStr) {
    const trades = loadTrades().filter(t => t.date === dateStr);

    if (calDayTitle) calDayTitle.textContent = `Trades ‚Äî ${dateStr}`;

    if (!trades.length) {
      calDayList.innerHTML = `<div class="cal-empty">No trades on this day.</div>`;
    } else {
      calDayList.innerHTML = trades
        .sort((a,b) => (b.id||0) - (a.id||0))
        .map(t => {
          const pnl = Number(t.pnl || 0);
          const pnlClass = pnl >= 0 ? "pnl-pos" : "pnl-neg";
          const dir = (t.direction || "").toLowerCase();
          const dirClass = dir === "sell" ? "sell" : "buy";
          const notes = (t.notes || "").replaceAll("<","&lt;").replaceAll(">","&gt;");

          return `
            <div class="cal-trade">
              <div class="cal-trade-top">
                <div class="cal-pair">${(t.pair||"").toUpperCase()}</div>
                <div class="badge ${dirClass}">${t.direction || ""}</div>
                <div class="cal-pnl ${pnlClass}">${pnl >= 0 ? "+" : ""}${pnl.toFixed(2)}</div>
              </div>
              ${notes ? `<div class="cal-notes">${notes}</div>` : ""}
            </div>
          `;
        })
        .join("");
    }

    calDayDetails.style.display = "block";
  }

  function hideDayDetails() {
    calDayDetails.style.display = "none";
  }

  // Click on calendar day
  if (calGrid) {
    calGrid.addEventListener("click", (e) => {
      const cell = e.target.closest(".cal-day");
      if (!cell) return;

      const dateStr = cell.dataset.date;
      if (!dateStr) return; // ignore empty cells / headers

      showDayDetails(dateStr);
    });
  }

  // Close button
  if (calCloseDetails) {
    calCloseDetails.addEventListener("click", hideDayDetails);
  }


    alert(`Trade saved ‚úÖ (Total trades: ${trades.length})`);

    form.reset();
    closeModal();
  });
  historyBody.addEventListener('click', (e) => {
  const btn = e.target.closest('[data-delete]');
  if (!btn) return;
  deleteTrade(btn.getAttribute('data-delete'));
});

clearTradesBtn.addEventListener('click', () => {
  const ok = confirm('Delete ALL trades? This cannot be undone.');
  if (!ok) return;
  saveTrades([]);
  renderHistory();
});
renderHistory();

</script>

</body>
</html>




















